{"version":3,"file":"AddOrderPopup-ZDuSAVib.js","sources":["../../../src/components/shared/popup/AddOrderPopup.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport {\r\n  createOrders,\r\n  changeAddOrderPopup,\r\n  getAllOrders,\r\n} from \"../../../utils/slice/userSlice\";\r\n\r\nimport Select from \"../../ui/Select\";\r\nimport Input from \"../../ui/Input\";\r\n\r\nconst options = [\r\n  { label: \"Доставлен\", value: \"Доставлен\" },\r\n  { label: \"Отменен\", value: \"Отменен\" },\r\n  { label: \"Оплачен\", value: \"Оплачен\" },\r\n];\r\n\r\nexport default function AddOrderPopup() {\r\n  const dispatch = useDispatch();\r\n  const orders = useSelector((state) => state.user.orders || []);\r\n  const [isOpen, setIsOpen] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    number: \"\",\r\n    date: \"\",\r\n    client_name: \"\",\r\n    state: \"\",\r\n    order_amount: \"\",\r\n  });\r\n\r\n  const handleSelectChange = (value) => {\r\n    setFormData((prevData) => ({\r\n      ...prevData,\r\n      state: value,\r\n    }));\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    // Clear error when user changes the number field\r\n    if (name === \"number\") {\r\n      setError(\"\");\r\n    }\r\n    setFormData((prevData) => ({\r\n      ...prevData,\r\n      [name]: value,\r\n    }));\r\n  };\r\n\r\n  const checkDuplicateOrder = (orderNumber) => {\r\n    return orders.some((order) => order.number === orderNumber);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      // Convert numeric fields before checking\r\n      const orderNumber = Number(formData.number);\r\n\r\n      // Check if order with the same number exists\r\n      if (checkDuplicateOrder(orderNumber)) {\r\n        setError(\"Заказ с таким номером уже существует.\");\r\n        return;\r\n      }\r\n\r\n      // Prepare data for submission\r\n      const submitData = {\r\n        ...formData,\r\n        number: orderNumber,\r\n        order_amount: Number(formData.order_amount),\r\n      };\r\n\r\n      await dispatch(createOrders(submitData));\r\n      await dispatch(getAllOrders());\r\n      setFormData({\r\n        name: \"\",\r\n        number: \"\",\r\n        date: \"\",\r\n        client_name: \"\",\r\n        state: \"\",\r\n        order_amount: \"\",\r\n      });\r\n      setError(\"\");\r\n      setIsOpen(false);\r\n    } catch (error) {\r\n      console.error(\"Failed to create order:\", error);\r\n      setError(\r\n        \"Не удалось создать заказ. Пожалуйста, проверьте введенные данные.\"\r\n      );\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    dispatch(changeAddOrderPopup(isOpen));\r\n  }, [isOpen]);\r\n\r\n  // Fetch orders when component mounts\r\n  useEffect(() => {\r\n    dispatch(getAllOrders());\r\n  }, []);\r\n\r\n  return (\r\n    <section className=\"fixed inset-0 flex items-center justify-center px-4 xs:px-5 sm:px-6 md:px-7 lg:px-8\">\r\n      <div\r\n        className=\"md:h-[70%] lg:h-[75%] bg-white py-[25px] xs:py-[28px] sm:py-[30px] md:py-[33px] lg:py-[35px] \r\n      xl:py-[38px] px-4 xs:px-5 sm:px-6 md:px-7 lg:px-8 rounded-lg w-[90%] xs:w-[85%] sm:w-[80%] \r\n      md:w-[70%] lg:w-[60%] xl:w-full max-w-[300px] xs:max-w-[350px] sm:max-w-[400px] md:max-w-[450px] l\r\n      g:max-w-[500px] xl:max-w-[663px] relative overflow-y-auto\"\r\n      >\r\n        <button\r\n          onClick={() => setIsOpen(false)}\r\n          className=\"absolute top-2 xs:top-2.5 sm:top-3 md:top-3.5 lg:top-4 right-2 xs:right-2.5 sm:right-3 md:right-3.5 lg:right-4 text-gray-500 hover:text-gray-700\"\r\n        >\r\n          ✕\r\n        </button>\r\n        <h2 className=\"text-center text-xl xs:text-2xl sm:text-2xl md:text-3xl lg:text-[32px] font-medium leading-[30px] xs:leading-[32px] sm:leading-[35px] md:leading-[38px] lg:leading-[40.8px] text-gray-400 mb-4 xs:mb-4.5 sm:mb-5 md:mb-5.5 lg:mb-10\">\r\n          Добавить заказ\r\n        </h2>\r\n        <form\r\n          onSubmit={handleSubmit}\r\n          className=\"space-y-[12px] xs:space-y-[14px] sm:space-y-[20px] md:space-y-[24px] lg:space-y-[40px]\"\r\n        >\r\n          <div className=\"space-y-[12px] xs:space-y-[14px] sm:space-y-[15px] md:space-y-[16px] lg:space-y-[18px]\">\r\n            <Input\r\n              type=\"text\"\r\n              name=\"name\"\r\n              placeholder=\"Наименование заказа\"\r\n              value={formData.name}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n            <div>\r\n              <Input\r\n                type=\"number\"\r\n                name=\"number\"\r\n                placeholder=\"Номер заказа\"\r\n                value={formData.number}\r\n                onChange={handleInputChange}\r\n                required\r\n              />\r\n              {error && <p className=\"text-red text-sm mt-1\">{error}</p>}\r\n            </div>\r\n            <Input\r\n              type=\"date\"\r\n              name=\"date\"\r\n              value={formData.date}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n            <Input\r\n              type=\"text\"\r\n              name=\"client_name\"\r\n              placeholder=\"Данные клиента\"\r\n              value={formData.client_name}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n            <Select\r\n              handleSelectChange={handleSelectChange}\r\n              options={options}\r\n              placeholder={\"Статус заказа\"}\r\n              border={true}\r\n              className={\r\n                \"w-full p-2 bg-gray-75 rounded focus:outline-none focus:ring-2 font-normal text-base text-gray-400 placeholder:text-gray-150\"\r\n              }\r\n            />\r\n            <Input\r\n              type=\"number\"\r\n              name=\"order_amount\"\r\n              placeholder=\"Сумма заказа\"\r\n              value={formData.order_amount}\r\n              onChange={handleInputChange}\r\n              required\r\n            />\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            className=\"w-full p-2 xs:p-2.5 sm:p-2.5 md:p-3 bg-gray-400 text-white uppercase rounded hover:bg-[#2F2F2F] transition-colors text-base xs:text-base sm:text-lg font-medium\"\r\n          >\r\n            Сохранить\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n"],"names":["options","AddOrderPopup","dispatch","useDispatch","orders","useSelector","state","isOpen","setIsOpen","useState","error","setError","formData","setFormData","handleSelectChange","value","prevData","__spreadProps","__spreadValues","handleInputChange","e","name","checkDuplicateOrder","orderNumber","order","handleSubmit","__async","submitData","createOrders","getAllOrders","useEffect","changeAddOrderPopup","jsx","jsxs","Input","Select"],"mappings":"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"}