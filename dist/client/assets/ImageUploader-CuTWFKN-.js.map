{"version":3,"file":"ImageUploader-CuTWFKN-.js","sources":["../../../src/components/ui/ImageUploader.jsx"],"sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useLocation } from \"react-router-dom\";\r\n\r\nconst ImageUploader = ({ onFileSelect, findProduct, banner = false }) => {\r\n  const [dragActive, setDragActive] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const inputRef = useRef(null);\r\n  const { itemId, addNewItemPopup, news, solutions, equipment } = useSelector(\r\n    ({ user }) => user\r\n  );\r\n  const { pathname } = useLocation();\r\n  const pathnameId = pathname.split(\"/\").at(-1);\r\n  let product = findProduct;\r\n  let isNews = +pathnameId === 4;\r\n  let isSolutions = +pathnameId === 3;\r\n\r\n  if (!findProduct) {\r\n    const itemsList = isNews ? news : isSolutions ? solutions : equipment;\r\n    product = itemsList?.find((item) => +item.id === +itemId);\r\n  }\r\n\r\n  const [previewUrl, setPreviewUrl] = useState(\r\n    isNews\r\n      ? product?.image\r\n      : banner\r\n      ? product?.image_banner\r\n      : product?.image_card || null\r\n  );\r\n\r\n  const handleDrag = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setDragActive(e.type === \"dragenter\" || e.type === \"dragover\");\r\n  };\r\n\r\n  const handleFile = (file) => {\r\n    if ([\"image/svg+xml\", \"image/png\", \"image/jpeg\"].includes(file.type)) {\r\n      const url = URL.createObjectURL(file);\r\n      setPreviewUrl(url);\r\n      if (onFileSelect) {\r\n        onFileSelect(file);\r\n      }\r\n      setError(\"\");\r\n    } else {\r\n      setError(\"Пожалуйста, загрузите PNG, или JPEG файл.\");\r\n    }\r\n  };\r\n\r\n  const handleDrop = (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setDragActive(false);\r\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\r\n      handleFile(e.dataTransfer.files[0]);\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    e.preventDefault();\r\n    if (e.target.files && e.target.files[0]) {\r\n      handleFile(e.target.files[0]);\r\n    }\r\n  };\r\n\r\n  const onButtonClick = () => {\r\n    inputRef.current?.click();\r\n  };\r\n\r\n  const removeImage = () => {\r\n    if (previewUrl) {\r\n      URL.revokeObjectURL(previewUrl);\r\n    }\r\n    setPreviewUrl(null);\r\n    setError(\"\");\r\n    if (onFileSelect) {\r\n      onFileSelect(null);\r\n    }\r\n    if (inputRef.current) {\r\n      inputRef.current.value = \"\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full mx-auto\">\r\n      {previewUrl && !addNewItemPopup && product ? (\r\n        <div className=\"relative p-8 mt-2 border-2 border-dashed rounded-lg text-center\">\r\n          <img\r\n            src={previewUrl}\r\n            alt=\"Текущее изображение\"\r\n            className=\"max-h-[200px] mx-auto rounded-lg\"\r\n          />\r\n          <button\r\n            type=\"button\"\r\n            onClick={(e) => {\r\n              e.preventDefault();\r\n              e.stopPropagation();\r\n              removeImage();\r\n            }}\r\n            className=\"absolute top-2 right-2 w-6 h-6 flex items-center justify-center bg-gray-800 text-white rounded-full hover:bg-gray-900\"\r\n          >\r\n            ×\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <div\r\n          className={`relative p-8 mt-2 border-2 border-dashed rounded-lg text-center cursor-pointer transition-colors\r\n            ${\r\n              dragActive\r\n                ? \"border-blue-400 bg-blue-50\"\r\n                : \"border-gray-300 hover:border-gray-400\"\r\n            }`}\r\n          onDragEnter={handleDrag}\r\n          onDragLeave={handleDrag}\r\n          onDragOver={handleDrag}\r\n          onDrop={handleDrop}\r\n          onClick={onButtonClick}\r\n        >\r\n          <input\r\n            ref={inputRef}\r\n            type=\"file\"\r\n            accept=\".svg,.png,.jpg,.jpeg\"\r\n            onChange={handleChange}\r\n            className=\"hidden\"\r\n          />\r\n\r\n          {previewUrl ? (\r\n            <>\r\n              <img\r\n                src={previewUrl}\r\n                alt=\"Предпросмотр\"\r\n                className=\"max-h-[200px] mx-auto rounded-lg\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                onClick={(e) => {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  removeImage();\r\n                }}\r\n                className=\"absolute top-2 right-2 w-6 h-6 flex items-center justify-center bg-gray-800 text-white rounded-full hover:bg-gray-900\"\r\n              >\r\n                ×\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <p className=\"mb-2 text-sm text-gray-500\">\r\n                <span className=\"font-semibold\">Нажмите, чтобы загрузить</span>{\" \"}\r\n                или перетащите\r\n              </p>\r\n              <p className=\"text-xs text-gray-500\">\r\n                PNG, JPG{\" \"}\r\n                {isNews\r\n                  ? \"(Рекомендуемое разрешение 847 x 300 px)\"\r\n                  : banner\r\n                  ? \"(Рекомендуемое разрешение 1920 x 900 px)\"\r\n                  : \"(Рекомендуемое разрешение 320 x 320 px)\"}\r\n              </p>\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {error && <p className=\"mt-2 text-red-500 text-sm\">{error}</p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageUploader;\r\n"],"names":["ImageUploader","onFileSelect","findProduct","banner","dragActive","setDragActive","useState","error","setError","inputRef","useRef","itemId","addNewItemPopup","news","solutions","equipment","useSelector","user","pathname","useLocation","pathnameId","product","isNews","isSolutions","itemsList","item","previewUrl","setPreviewUrl","handleDrag","handleFile","file","url","handleDrop","handleChange","onButtonClick","_a","removeImage","jsxs","jsx","Fragment"],"mappings":"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"}